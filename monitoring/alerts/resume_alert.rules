groups:
  - name: resume-alerts
    rules:
      - alert: ResumeUploadHighErrorRate
        expr: |
          rate(resume_upload_errors_total[5m]) / rate(resume_upload_requests_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High error rate on resume upload"
          description: "More than 10% of resume uploads are failing over the last 5 minutes."

      - alert: ResumeAnalysisLatencyHigh
        expr: |
          histogram_quantile(0.95, sum(rate(resume_analysis_duration_seconds_bucket[5m])) by (le)) > 2
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "Resume analysis latency is high"
          description: "95th percentile latency for resume analysis exceeds 2 seconds."

      - alert: ResumeServiceDown
        expr: |
          up{job="resume-service"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Resume service is down"
          description: "The resume-service job is not reporting as up."

      - alert: ResumePDFExportFailures
        expr: |
          increase(resume_pdf_export_errors_total[10m]) > 5
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "PDF export failures detected"
          description: "More than 5 PDF export errors occurred in the last 10 minutes."

      - alert: ResumeHistoryFetchErrors
        expr: |
          rate(resume_history_fetch_errors_total[5m]) > 0.05
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Resume history fetch errors"
          description: "Resume history endpoint is returning errors at a rate > 0.05/s."
        - alert: ResumeStorageLatencyHigh 
        expr: |
          histogram_quantile(0.95, sum(rate(resume_storage_latency_seconds_bucket[5m])) by (le)) > 1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Resume storage latency is high"
            description: "95th percentile latency for resume storage operations exceeds 1 second."